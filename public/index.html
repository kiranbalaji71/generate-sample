<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Document Generator</title>
    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />

    <style>
      body {
        background: #f4f7fa;
      }
      /* Keep custom progress bar */
      .progress-container {
        width: 100%;
        max-width: 400px;
        margin: 10px auto;
        background: #e0e0e0;
        border-radius: 25px;
        overflow: hidden;
        height: 10px;
        display: none;
      }
      .progress-bar {
        height: 100%;
        width: 0%;
        background: linear-gradient(90deg, #4caf50, #66bb6a);
        transition: width 0.2s ease-in-out;
      }
    </style>
  </head>
  <body class="bg-light">
    <div
      class="container d-flex justify-content-center align-items-center vh-100"
    >
      <div class="card shadow p-4" style="max-width: 450px; width: 100%">
        <h4 class="mb-3">Generate Documents</h4>

        <!-- Select + Input -->
        <div class="mb-3">
          <label for="docType" class="form-label">Doc Type & Count:</label>
          <div class="input-group">
            <select id="docType" class="form-select"></select>
            <input
              type="number"
              id="sampleCount"
              class="form-control"
              value="1"
              min="1"
              style="max-width: 100px"
            />
          </div>
        </div>

        <!-- Button -->
        <button class="btn btn-dark w-100" onclick="generate()">
          Generate
        </button>

        <!-- Progress bar -->
        <div class="progress-container" id="progressContainer">
          <div class="progress-bar" id="progressBar"></div>
        </div>

        <!-- Status -->
        <p id="status" class="mt-3 text-center"></p>
      </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <script>
      async function loadOptions() {
        const res = await fetch(
          "https://generate-sample.onrender.com/options?" + new Date().getTime()
        ); // cache-buster
        const options = await res.json();
        const select = document.getElementById("docType");
        select.innerHTML = "";
        options.forEach((opt) => {
          const option = document.createElement("option");
          option.value = opt.value;
          option.textContent = opt.label;
          select.appendChild(option);
        });
      }
      window.onload = loadOptions;
    </script>

    <script>
      async function generate() {
        const type = document.getElementById("docType").value;
        const sample = document.getElementById("sampleCount").value;
        const progressContainer = document.getElementById("progressContainer");
        const progressBar = document.getElementById("progressBar");
        const status = document.getElementById("status");

        status.innerText = "";
        progressContainer.style.display = "block";
        progressBar.style.width = "0%";

        let progress = 0;
        const interval = setInterval(() => {
          progress = Math.min(progress + Math.random() * 15, 95);
          progressBar.style.width = progress + "%";
        }, 400);

        try {
          const res = await fetch(
            "https://generate-sample.onrender.com/generate",
            {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({ type, sample }),
            }
          );

          if (!res.ok) throw new Error("Failed request");

          const blob = await res.blob();
          clearInterval(interval);
          progressBar.style.width = "100%";

          // Download zip
          const url = window.URL.createObjectURL(blob);
          const a = document.createElement("a");
          a.href = url;
          a.download = `${type}_sample_${new Date().getTime()}.zip`;
          document.body.appendChild(a);
          a.click();
          a.remove();
          window.URL.revokeObjectURL(url);

          status.innerText = `‚úÖüéâ Successfully Download ${type}_sample.zip`;
        } catch (error) {
          clearInterval(interval);
          status.innerText = "‚ùå Failed to generate. Please try again.";
        }
      }
    </script>
  </body>
</html>
